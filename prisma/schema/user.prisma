enum UserRole {
  PARTICIPATOR
  HOST
  ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  DELETED
}

enum Gender {
  MALE
  FEMALE
}

enum HostApplicationStatus {
  PENDING
  APPROVED
  REJECTED
}

enum EventStatus {
  UPCOMING    
  REGISTRATION_CLOSED
  LIVE
  COMPLETED
}

enum PaymentStatus {
  PAID
  UNPAID
  FAILED
  SUCCESS
}

enum PaymentMethod {
  STRIPE
  PAYPAL
  SSL_COMMERZ
}


// =======================
// USER MODEL
// =======================
model User {
  id                 String     @id @default(uuid())
  email              String     @unique
  password           String
  role               UserRole   @default(PARTICIPATOR)
  needPasswordChange Boolean    @default(false)
  status             UserStatus @default(ACTIVE)
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt

  admin        Admin?
  host         Host?
  participator Participator?

  events   Event[]   @relation("UserEvents")
  reviews  Review[]  @relation("UserReviews")
  payments Payment[] @relation("UserPayments")

  eventParticipations EventParticipator[] @relation("UserEventParticipations")
  hostApplications    HostApplication[]   @relation("UserHostApplications")

  @@map("users")
}

// =======================
// ADMIN MODEL
// =======================
model Admin {
  id            String   @id @default(uuid())
  name          String
  email         String   @unique
  profilePhoto  String?
  contactNumber String
  isDeleted     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user User @relation(fields: [email], references: [email])

  handledApplications HostApplication[] @relation("AdminReviewedApplications")

  @@map("admins")
}

model Participator {
  id            String   @id @default(uuid())
  email         String   @unique
  name          String
  profilePhoto  String?
  address       String?
  contactNumber String?
  interests     String?
  bio           String?
  isDeleted     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user User @relation(fields: [email], references: [email])

  reviews             Review[]            @relation("ParticipatorReviews")
  eventParticipations EventParticipator[]
  hostApplications    HostApplication[]   @relation("ParticipatorHostApplications")

  @@map("participators")
}

model HostApplication {
  id             String                @id @default(uuid())
  userId         String
  participatorId String
  adminEmail     String?
  status         HostApplicationStatus @default(PENDING)
  message        String?
  adminNote      String?
  createdAt      DateTime              @default(now())
  updatedAt      DateTime              @updatedAt
  isDeleted      Boolean               @default(false)
  user           User                  @relation("UserHostApplications", fields: [userId], references: [id])
  participator   Participator          @relation("ParticipatorHostApplications", fields: [participatorId], references: [id])
  admin          Admin?                @relation("AdminReviewedApplications", fields: [adminEmail], references: [email])

  @@map("host_applications")
}

model Host {
  id            String   @id @default(uuid())
  name          String
  email         String   @unique
  profilePhoto  String?
  contactNumber String?
  address       String
  averageRating Float    @default(0)
  isDeleted     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user   User    @relation(fields: [email], references: [email])
  events Event[] @relation("HostEvents")

  @@map("hosts")
}
model EventParticipator {
  id             String   @id @default(uuid())
  eventId        String
  userId         String
  participatorId String?
  joinedAt       DateTime @default(now())
  isBooked       Boolean  @default(false)
  paymentId     String?  @unique
  // One-to-one relation with Payment
  payment        Payment? @relation("ParticipationPayment") 

  event        Event         @relation(fields: [eventId], references: [id])
  user         User          @relation("UserEventParticipations", fields: [userId], references: [id])
  participator Participator? @relation(fields: [participatorId], references: [id])

  @@unique([eventId, userId])
  @@map("event_participators")
}

model Payment {
  id                   String            @id @default(uuid())
  amount               Float             @default(0)
  status               PaymentStatus     @default(UNPAID)
  method               PaymentMethod?
  transactionId        String            @unique
  eventParticipationId String?           @unique
  createdAt            DateTime          @default(now())
  updatedAt            DateTime          @updatedAt

  // Define one-to-one relation (opposite side)
  eventParticipation EventParticipator? @relation("ParticipationPayment", fields: [eventParticipationId], references: [id])

  userId String
  user   User @relation("UserPayments", fields: [userId], references: [id])

  eventId String
  event   Event @relation(fields: [eventId], references: [id])

  @@map("payments")
}

model Event {
  id              String       @id @default(uuid())
  title           String
  description     String
  bannerPhoto     String?
  dateTime        DateTime
  location        String
  minParticipants Int?
  maxParticipants Int?
  availableSeats  Int?

  joiningFee Int
  eventType  String

  status     EventStatus  @default(UPCOMING)

  isDeleted  Boolean      @default(false)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  hostId String?
  host   Host?   @relation("HostEvents", fields: [hostId], references: [id])

  createdByEmail String
  user           User   @relation("UserEvents", fields: [createdByEmail], references: [email])

  participators EventParticipator[]
  reviews       Review[]
  payments      Payment[] // now this works, no opposite field needed

  @@map("events")
}


model Review {
  id        String   @id @default(uuid())
  rating    Int
  comment   String?

  eventId        String
  participatorId String
  userId         String?

  event        Event        @relation(fields: [eventId], references: [id])
  participator Participator @relation("ParticipatorReviews", fields: [participatorId], references: [id])
  user         User?        @relation("UserReviews", fields: [userId], references: [id])
  createdAt DateTime @default(now())

  @@map("reviews")
}

